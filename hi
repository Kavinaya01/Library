public void returnBook(int borrowId) {
    BorrowTransaction borrow = borrowRepository.findById(borrowId)
        .orElseThrow(() -> new RuntimeException("Borrow transaction not found"));

    borrow.setStatus("returned");
    borrow.setReturnDate(LocalDate.now());
    borrowRepository.save(borrow);

    // Update book status
    Book book = borrow.getBook();
    book.setStatus("available");
    bookRepository.save(book);

    // Increment available copies
    AvailableCount count = availableCountRepository.findByIsbn(book.getIsbn())
        .orElseThrow(() -> new RuntimeException("Available copy info not found"));
    count.setAvailableCopies(count.getAvailableCopies() + 1);
    availableCountRepository.save(count);
}
